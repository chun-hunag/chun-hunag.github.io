<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jam-boxes.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Share tech notes and investment experience">
<meta property="og:type" content="website">
<meta property="og:title" content="Jam&#39;s Box">
<meta property="og:url" content="https://jam-boxes.com/index.html">
<meta property="og:site_name" content="Jam&#39;s Box">
<meta property="og:description" content="Share tech notes and investment experience">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="jam huang">
<meta property="article:tag" content="code, programming, php, golang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jam-boxes.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Jam's Box</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jam's Box</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Leaning Note</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/chun-hunag" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jam-boxes.com/build-a-rabbitmq-cluster-including-haporxy-by-docker-composer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Tombili_mini.jpg">
      <meta itemprop="name" content="jam huang">
      <meta itemprop="description" content="Share tech notes and investment experience">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jam's Box">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/build-a-rabbitmq-cluster-including-haporxy-by-docker-composer/" class="post-title-link" itemprop="url">Build a RabbitMQ cluster including HAPorxy by docker-composer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-15 02:38:57" itemprop="dateCreated datePublished" datetime="2022-05-15T02:38:57+00:00">2022-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-14 18:54:09" itemprop="dateModified" datetime="2022-05-14T18:54:09+00:00">2022-05-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-composer"><a href="#Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-composer" class="headerlink" title="Build a RabbitMQ cluster including HAPorxy by docker-composer"></a>Build a RabbitMQ cluster including HAPorxy by docker-composer</h1><hr>
<p>This article is composed of this part:</p>
<ul>
<li>Why do we need a RabbitMQ cluster?</li>
<li>How many ways we can build a RabbitMQ cluster and which way is this article used?</li>
<li>Some things we need to know before starting</li>
<li>Build RabbitMQ cluster through CLI command manually</li>
<li>Build RabbitMQ cluster through docker-composer</li>
<li>Add HAProxy as load balance.</li>
<li>Build by docker-compose</li>
<li>Completed <code>docker-compose.yml</code> and directory structure</li>
<li>Source code</li>
</ul>
<h2 id="Why-do-we-need-a-RabbitMQ-cluster"><a href="#Why-do-we-need-a-RabbitMQ-cluster" class="headerlink" title="Why do we need a RabbitMQ cluster?"></a>Why do we need a RabbitMQ cluster?</h2><hr>
<p>Make sure that Producer and Consumer can still work even if one of a node in the cluster failed.</p>
<p>The cluster provides higher stability and also sacrifices part of the performance. </p>
<p>Because nodes in the clusters have to sync messages to each other, this means that the more nodes exist in the cluster, the more time will be costed on syncing messages to each other.</p>
<h2 id="How-many-ways-we-can-build-RabbitMQ-cluster"><a href="#How-many-ways-we-can-build-RabbitMQ-cluster" class="headerlink" title="How many ways we can build  RabbitMQ cluster ?"></a>How many ways we can build  RabbitMQ cluster ?</h2><hr>
<p>According to rabbitmq’s official website, there are several ways to form a cluster:</p>
<ul>
<li><strong>Declaratively by listing cluster nodes in config file</strong></li>
<li><strong>Declaratively using DNS-based discovery</strong></li>
<li>Declaratively using AWS (EC2) instance discovery (via a plugin)</li>
<li>Declaratively using Kubernetes discovery (via a plugin)</li>
<li>Declaratively using Consul-based discovery (via a plugin)</li>
<li>Declaratively using Consul-based discovery (via a plugin)</li>
<li><strong>Manually with <code>rabbitmqctl</code></strong></li>
</ul>
<p>In this article, we will describe how to form rabbitmq cluster </p>
<p>throught  <strong><code>rabbitmqctl</code> and use docker-compose to make this process automated.</strong></p>
<h2 id="Some-things-we-need-to-know-before-starting"><a href="#Some-things-we-need-to-know-before-starting" class="headerlink" title="Some things we need to know before starting"></a>Some things we need to know before starting</h2><hr>
<ul>
<li><p>The RabbitMQ cluster is based on Erlang. We need to start the Erlang node before we build the cluster.</p>
<p>  The communication between Erlang nodes is relying on Erlang Cookies, so we need to make all RabbitMQ nodes’ Erlang Cookies value the same.</p>
</li>
</ul>
<h2 id="Build-RabbitMQ-cluster-through-rabbitmqctl-manually"><a href="#Build-RabbitMQ-cluster-through-rabbitmqctl-manually" class="headerlink" title="Build RabbitMQ cluster through rabbitmqctl manually"></a>Build RabbitMQ cluster through <strong><code>rabbitmqctl</code></strong> manually</h2><hr>
<h3 id="Run-three-RabbitMQ-container"><a href="#Run-three-RabbitMQ-container" class="headerlink" title="Run three RabbitMQ container"></a>Run three RabbitMQ container</h3><hr>
<ul>
<li><code>docker run -d --hostname rabbitmq01 --name rabbit01 -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest -e RABBITMQ_ERLANG_COOKIE=myerlangcookies -p 5672:5672 -p 15672:15672 rabbitmq:3.9-management</code></li>
<li><code>docker run -d --hostname rabbitmq02 --name rabbit02 -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest -e RABBITMQ_ERLANG_COOKIE=myerlangcookies -p 5673:5672 -p 15673:15672 rabbitmq:3.9-management</code></li>
<li><code>docker run -d --hostname rabbitmq03 --name rabbit03 -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest -e RABBITMQ_ERLANG_COOKIE=myerlangcookies -p 5674:5672 -p 15674:15672 rabbitmq:3.9-management</code></li>
</ul>
<h3 id="Check-Management-UI"><a href="#Check-Management-UI" class="headerlink" title="Check Management UI"></a>Check Management UI</h3><hr>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://127.0.0.1:15672/#/">http://127.0.0.1:15672/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://127.0.0.1:15672/#/">http://127.0.0.1:15673/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://127.0.0.1:15672/#/">http://127.0.0.1:15674/</a></p>
<p>  <img src="/../images/002.Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-compose/002-image.png" alt="Untitled"></p>
</li>
</ul>
<h3 id="Get-IP-of-rabbitmq-containers"><a href="#Get-IP-of-rabbitmq-containers" class="headerlink" title="Get IP of rabbitmq containers"></a>Get IP of rabbitmq containers</h3><hr>
<ul>
<li><p><code>docker exec -it rabbit01 hostname -I</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.2</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>docker exec -it rabbit02 hostname -I</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.3</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>docker exec -it rabbit03 hostname -I</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.4</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Add-IP-to-container’s-hosts"><a href="#Add-IP-to-container’s-hosts" class="headerlink" title="Add IP to container’s hosts"></a>Add IP to container’s hosts</h3><hr>
<ul>
<li><p><code>docker exec -it rabbit01 bash</code>  &amp; <code>docker exec -it rabbit02 bash</code>  &amp; <code>docker exec -it rabbit03 bash</code></p>
</li>
<li><p><code>apt-get update</code></p>
</li>
<li><p><code>apt-get install vim</code></p>
</li>
<li><p><code>vi /etc/hosts</code></p>
<p>  Add this line (replace IP to the IP you get previous step):</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.2      rabbitmq01</span><br><span class="line">172.17.0.3      rabbitmq02</span><br><span class="line">172.17.0.4      rabbitmq03</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="RabbitMQ-2-and-3-join-cluster"><a href="#RabbitMQ-2-and-3-join-cluster" class="headerlink" title="RabbitMQ 2 and 3 join cluster"></a>RabbitMQ 2 and 3 join cluster</h3><hr>
<ul>
<li><p>Login rabbit02 &amp; rabbit03:</p>
<p>   <code>docker exec -it rabbit02 bash</code></p>
</li>
<li><p>stop rabbitmq application:</p>
<p>  <code>rabbitmqctl stop_app</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rabbitmqctl stop_app</span><br><span class="line">Stopping rabbit application on node rabbit@rabbitmq02 ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Join Cluster:</p>
<p>  <code>rabbitmqctl join_cluster rabbit@rabbitmq01</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmqctl join_cluster rabbit@rabbitmq01</span></span><br><span class="line">Clustering node rabbit@rabbitmq02 with rabbit@rabbitmq01</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start App:</p>
<p>  <code>rabbitmqctl start_app</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Starting node rabbit@rabbitmq02 ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>After you done, you will see:</p>
<p>  <img src="/../images/002.Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-compose/002-image%201.png" alt="Untitled"></p>
</li>
</ul>
<h2 id="Build-RabbitMQ-cluster-through-docker-composer"><a href="#Build-RabbitMQ-cluster-through-docker-composer" class="headerlink" title="Build RabbitMQ cluster through docker-composer"></a>Build RabbitMQ cluster through docker-composer</h2><hr>
<h3 id="First-let’s-look-at-dockerthe-compose-yml"><a href="#First-let’s-look-at-dockerthe-compose-yml" class="headerlink" title="First, let’s look at  dockerthe -compose.yml"></a>First, let’s look at  <code>dockerthe -compose.yml</code></h3><p>We make all services on same network, so we don’t need to handle hosts.</p>
<p>There are two types of rabbitmq service: master and slave, and use two different Dockerfile: <code>Dockerfile-master</code>, <code>Dockerfile-slave</code></p>
<p>We volume  <code>/etc/rabbitmq/enabled_plugins</code> to control what plugin we open.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mqNetwork:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq-cluster-01:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-master</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-02:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15673</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-03:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15674</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line">	<span class="string">.</span></span><br><span class="line">  <span class="string">.</span></span><br><span class="line">  <span class="string">.</span></span><br></pre></td></tr></table></figure>

<h3 id="Second-let’s-look-at-two-types-of-Dockerfile-for-build-RabbitMQ"><a href="#Second-let’s-look-at-two-types-of-Dockerfile-for-build-RabbitMQ" class="headerlink" title="Second, let’s look at two types of Dockerfile for build RabbitMQ :"></a>Second, let’s look at two types of Dockerfile for build RabbitMQ :</h3><p><code>Dockerfile-master</code></p>
<ul>
<li>Copy <code>.erlang.cookie</code> to <code>/var/lib/rabbitmq/.erlang.cookie</code> , so all of rabbitmq services have same <code>.erlang.cookie</code> .</li>
<li><code>[master.sh](http://master.sh)</code>  is start script for  master node.</li>
</ul>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> RABBITMQ_VERSION</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> rabbitmq:$RABBITMQ_VERSION-management</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> .erlang.cookie /var/lib/rabbitmq/.erlang.cookie</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> master.sh /usr/local/bin/</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/usr/local/bin/docker-entrypoint.sh&quot;</span> ]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">chmod</span> 400 /var/lib/rabbitmq/.erlang.cookie &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    /usr/local/bin/master.sh</span></span><br></pre></td></tr></table></figure>

<p><code>Dockerfile-slave</code></p>
<ul>
<li>Copy <code>.erlang.cookie</code> to <code>/var/lib/rabbitmq/.erlang.cookie</code> , so all of rabbitmq services have same <code>.erlang.cookie</code> .</li>
<li><code>[slave.sh](http://slave.sh)</code> is start script for slave node.</li>
<li><code>tail -f /dev/null</code> is for keeping container running.</li>
</ul>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> RABBITMQ_VERSION</span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> rabbitmq:$RABBITMQ_VERSION-management</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> .erlang.cookie /var/lib/rabbitmq/.erlang.cookie</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> slave.sh /usr/local/bin/</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;/usr/local/bin/docker-entrypoint.sh&quot;</span> ]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">chmod</span> 400 /var/lib/rabbitmq/.erlang.cookie &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    /usr/local/bin/slave.sh &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">tail</span> -f /dev/null</span></span><br></pre></td></tr></table></figure>

<h3 id="Third-two-types-of-start-script-master-sh-http-master-sh-slave-sh"><a href="#Third-two-types-of-start-script-master-sh-http-master-sh-slave-sh" class="headerlink" title="Third, two types of start script: [master.sh](http://master.sh) , slave.sh"></a>Third, two types of start script: <code>[master.sh](http://master.sh)</code> , <code>slave.sh</code></h3><p><code>master.sh</code></p>
<ul>
<li>master node just need to start server  —  start  erlang runtime and rabbitmq node</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># start rabbitmq service </span></span><br><span class="line">rabbitmq-server</span><br></pre></td></tr></table></figure>

<p><code>slave.sh</code></p>
<ul>
<li>slave node start rabbitmq-server first and sleep sometime to make sure erlang runtime and rabbitmq node is prepared.</li>
<li>execute  <code>stop_app</code>  to stop rabbitmq node and execute  <code>join_cluster</code>  to  become a member of the cluster</li>
<li>execute <code>start_app</code> to start rabbitmq node again.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># start rabbitmq service in backgorund (erlang node and rabbitmq application , detached mean in background)</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 15s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stops the RabbitMQ application, leaving the runtime (Erlang VM) running</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instructs the node to become a member of the cluster that the specified node is in</span></span><br><span class="line">rabbitmqctl join_cluster <span class="variable">$&#123;MASTER_NODE_HOST_NAME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start rabbitmq application 來 sync 資料</span></span><br><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>

<h3 id="Dependence"><a href="#Dependence" class="headerlink" title="Dependence"></a>Dependence</h3><ul>
<li>As a master node, rabbitmq-cluster-01 must start up first, and then other slave nodes like rabbitmq-cluster-02,  rabbitmq-cluster-03 … etc.</li>
<li>HAProxy should start up after all rabbitmq-cluster started up.</li>
</ul>
<h2 id="Add-HAProxy-as-load-balance"><a href="#Add-HAProxy-as-load-balance" class="headerlink" title="Add HAProxy as load balance."></a>Add HAProxy as load balance.</h2><hr>
<p><code>docker-compose.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mqNetwork:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">	<span class="string">.</span></span><br><span class="line">	<span class="string">.</span> </span><br><span class="line">	<span class="string">.</span></span><br><span class="line">	<span class="attr">haproxy:</span></span><br><span class="line">	    <span class="attr">build:</span> </span><br><span class="line">	        <span class="attr">context:</span> <span class="string">./haproxy</span></span><br><span class="line">	        <span class="attr">args:</span> </span><br><span class="line">	          <span class="attr">HAPROXY_VERSION:</span> <span class="string">$&#123;HAPROXY_VERSION&#125;</span></span><br><span class="line">	    <span class="attr">container_name:</span> <span class="string">haproxy</span></span><br><span class="line">	    <span class="attr">ports:</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="number">8100</span><span class="string">:8100</span></span><br><span class="line">	    <span class="attr">depends_on:</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">				<span class="bullet">-</span> <span class="string">rabbitmq-cluster-04</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-05</span></span><br><span class="line">	    <span class="attr">networks:</span></span><br><span class="line">	      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">	    <span class="attr">volumes:</span></span><br><span class="line">	     <span class="bullet">-</span> <span class="string">./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile-for-haproxy"><a href="#Dockerfile-for-haproxy" class="headerlink" title="Dockerfile for haproxy"></a>Dockerfile for haproxy</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> HAPROXY_VERSION</span><br><span class="line"><span class="keyword">FROM</span> haproxy:$HAPROXY_VERSION</span><br></pre></td></tr></table></figure>

<h3 id="haproxy-cfg"><a href="#haproxy-cfg" class="headerlink" title="haproxy.cfg"></a>haproxy.cfg</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------------------------------- </span></span><br><span class="line"><span class="comment"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will </span></span><br><span class="line"><span class="comment"># use if not designated in their block </span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------- </span></span><br><span class="line">global</span><br><span class="line">daemon</span><br><span class="line"></span><br><span class="line">    defaults</span><br><span class="line">    mode tcp</span><br><span class="line">    maxconn <span class="number">10000</span></span><br><span class="line">    timeout connect <span class="number">5</span>s</span><br><span class="line">    timeout client <span class="number">100</span>s</span><br><span class="line">    timeout server <span class="number">100</span>s</span><br><span class="line"></span><br><span class="line">frontend stats</span><br><span class="line">    *bind *:<span class="number">8100</span>*</span><br><span class="line">    mode http</span><br><span class="line">    stats enable</span><br><span class="line">    stats uri /stats</span><br><span class="line">    stats refresh <span class="number">10</span>s</span><br><span class="line">    stats admin if LOCALHOST</span><br><span class="line"></span><br><span class="line">frontend rabbitmq</span><br><span class="line">    bind *:<span class="number">5672</span></span><br><span class="line">    use_backend rabbitmq-server</span><br><span class="line"></span><br><span class="line">backend rabbitmq-server</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server rabbitmaster rabbitmq-cluster-<span class="number">01</span>:<span class="number">5672</span> check inter <span class="number">5</span>s rise <span class="number">2</span> fall <span class="number">3</span></span><br><span class="line">    server rabbitslave1 rabbitmq-cluster-<span class="number">02</span>:<span class="number">5672</span> check inter <span class="number">5</span>s rise <span class="number">2</span> fall <span class="number">3</span></span><br><span class="line">	  server rabbitslave2 rabbitmq-cluster-<span class="number">03</span>:<span class="number">5672</span> check inter <span class="number">5</span>s rise <span class="number">2</span> fall <span class="number">3</span></span><br><span class="line">    server rabbitslave3 rabbitmq-cluster-<span class="number">04</span>:<span class="number">5672</span> check inter <span class="number">5</span>s rise <span class="number">2</span> fall <span class="number">3</span></span><br><span class="line">    server rabbitslave4 rabbitmq-cluster-<span class="number">05</span>:<span class="number">5672</span> check inter <span class="number">5</span>s rise <span class="number">2</span> fall <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="Completed-docker-compose-yml-and-directory-structure"><a href="#Completed-docker-compose-yml-and-directory-structure" class="headerlink" title="Completed docker-compose.yml and directory structure"></a>Completed <code>docker-compose.yml</code> and directory structure</h2><hr>
<h3 id="Completed-docker-compose-yml"><a href="#Completed-docker-compose-yml" class="headerlink" title="Completed docker-compose.yml"></a>Completed <code>docker-compose.yml</code></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mqNetwork:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq-cluster-01:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-master</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-02:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15673</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-03:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15674</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-04:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-04</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-04</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15675</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rabbitmq-cluster-05:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./rabbitmq</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-slave</span></span><br><span class="line">      <span class="attr">args:</span> </span><br><span class="line">        <span class="attr">RABBITMQ_VERSION:</span> <span class="number">3.9</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">rabbitmq-cluster-05</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq-cluster-05</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">15676</span><span class="string">:15672</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_NODENAME=rabbitmq</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MASTER_NODE_HOST_NAME=rabbitmq@rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rabbitmq/config/enabled_plugins:/etc/rabbitmq/enabled_plugins</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">haproxy:</span></span><br><span class="line">    <span class="attr">build:</span> </span><br><span class="line">        <span class="attr">context:</span> <span class="string">./haproxy</span></span><br><span class="line">        <span class="attr">args:</span> </span><br><span class="line">          <span class="attr">HAPROXY_VERSION:</span> <span class="string">$&#123;HAPROXY_VERSION&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">haproxy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8100</span><span class="string">:8100</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-04</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rabbitmq-cluster-05</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mqNetwork</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg</span></span><br></pre></td></tr></table></figure>

<h3 id="Directory-Structure"><a href="#Directory-Structure" class="headerlink" title="Directory Structure"></a>Directory Structure</h3><p><img src="/../images/002.Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-compose/002-image%202.png" alt="Untitled"></p>
<h2 id="Build-by-docker-compose"><a href="#Build-by-docker-compose" class="headerlink" title="Build by docker-compose"></a>Build by docker-compose</h2><hr>
<ul>
<li><p><code>docker-compose up -d</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[+] Building 2.7s (27/33)</span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-05 internal] load build definition from Dockerfil  0.0s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 409B                                                          0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-02 internal] load build definition from Dockerfil  0.0s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 409B                                                          0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-01 internal] load build definition from Dockerfil  0.0s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 384B                                                          0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-03 internal] load build definition from Dockerfil  0.0s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 409B                                                          0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_haproxy internal] load build definition from Dockerfile             0.0s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 87B                                                           0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-04 internal] load build definition from Dockerfil  0.1s </span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 409B                                                          0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-05 internal] load .dockerignore                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-02 internal] load .dockerignore                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-01 internal] load .dockerignore                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-03 internal] load .dockerignore                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_haproxy internal] load .dockerignore                                0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-04 internal] load .dockerignore                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-04 internal] load metadata <span class="keyword">for</span> docker.io/library/  0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-04 1/4] FROM docker.io/library/rabbitmq:3.9-manag  0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-05 internal] load build context                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 530B                                                             0.0s </span><br><span class="line"> =&gt; CACHED [rabbitmq-cluster-env_rabbitmq-cluster-01 2/4] RUN <span class="built_in">echo</span> <span class="string">&quot;Build version: 3.9.13&quot;</span>    0.0s </span><br><span class="line"> =&gt; CACHED [rabbitmq-cluster-env_rabbitmq-cluster-05 3/4] COPY .erlang.cookie /var/lib/rabbi  0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-05 4/4] COPY slave.sh /usr/local/bin/              0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-02 internal] load build context                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 530B                                                             0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-01 internal] load build context                    0.0s </span><br><span class="line"> =&gt; =&gt; transferring context: 210B                                                             0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_haproxy] exporting to image                                         0.2s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                       0.0s </span><br><span class="line"> =&gt; =&gt; writing image sha256:7cb933b9ff00e6c50cc84042063f5df6bcb118b205b64096a4c6fdf8dc6b297c  0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_rabbitmq-cluster-05                   0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_rabbitmq-cluster-02                   0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_rabbitmq-cluster-03                   0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_rabbitmq-cluster-04                   0.0s </span><br><span class="line"> =&gt; =&gt; writing image sha256:de6b6cf48cfa0b1123f4fc2922ad1f116528b766c7850f856c6ce5220bade7b6  0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_rabbitmq-cluster-01                   0.0s </span><br><span class="line"> =&gt; =&gt; writing image sha256:274925b27a9e25ff77b491434e1e96255a3ef882038e88a3aa75be4990ffd1e6  0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/rabbitmq-cluster-env_haproxy                               0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-03 internal] load build context                    0.1s </span><br><span class="line"> =&gt; =&gt; transferring context: 530B                                                             0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_haproxy internal] load metadata <span class="keyword">for</span> docker.io/library/haproxy:2.3   2.2s </span><br><span class="line"> =&gt; CACHED [rabbitmq-cluster-env_rabbitmq-cluster-01 3/4] COPY .erlang.cookie /var/lib/rabbi  0.0s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-01 4/4] COPY master.sh /usr/local/bin/             0.1s </span><br><span class="line"> =&gt; [rabbitmq-cluster-env_rabbitmq-cluster-04 internal] load build context                    0.1s </span><br><span class="line"> =&gt; =&gt; transferring context: 530B                                                             0.0s </span><br><span class="line"> =&gt; CACHED [rabbitmq-cluster-env_haproxy 1/1] FROM docker.io/library/haproxy:2.3@sha256:7a9b  0.0s</span><br><span class="line"></span><br><span class="line">[+] Running 7/7</span><br><span class="line"> - Network rabbitmq-cluster-env_mqNetwork  Create...                                          0.7s </span><br><span class="line"> - Container rabbitmq-cluster-01           Started                                            2.5s</span><br><span class="line"> - Container rabbitmq-cluster-02           Started                                            6.4s</span><br><span class="line"> - Container rabbitmq-cluster-04           Started                                            5.3s </span><br><span class="line"> - Container rabbitmq-cluster-03           Started                                            5.1s </span><br><span class="line"> - Container rabbitmq-cluster-05           Started                                            6.1s </span><br><span class="line"> - Container haproxy                       Started                                            8.0s</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check RabbitMQ management GUI:  <a target="_blank" rel="noopener" href="http://localhost:15672/#/">http://127.0.0.1:15672/</a></p>
<p>  <img src="/../images/002.Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-compose/002-image%203.png" alt="Untitled"></p>
</li>
<li><p>Check  HAProxy stats page: <a target="_blank" rel="noopener" href="http://127.0.0.1:8100/stats">http://127.0.0.1:8100/stats</a></p>
<p>  <img src="/../images/002.Build-a-RabbitMQ-cluster-including-HAPorxy-by-docker-compose/002-image%204.png" alt="Untitled"></p>
</li>
</ul>
<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><hr>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/chun-hunag/rabbitmq-sample/tree/main/rabbitmq-cluster-env">Github Link</a></li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><hr>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/clustering.html">https://www.rabbitmq.com/clustering.html</a></li>
<li><a target="_blank" rel="noopener" href="http://kuma-uni.blogspot.com/2017/03/rabbitmqha-rabbitmq-1.html">http://kuma-uni.blogspot.com/2017/03/rabbitmqha-rabbitmq-1.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.yowko.com/docker-compose-rabbitmq-cluster/">https://blog.yowko.com/docker-compose-rabbitmq-cluster/</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jam-boxes.com/declare-quorum-queue-with-go-language/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Tombili_mini.jpg">
      <meta itemprop="name" content="jam huang">
      <meta itemprop="description" content="Share tech notes and investment experience">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jam's Box">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/declare-quorum-queue-with-go-language/" class="post-title-link" itemprop="url">Declare Quorum queue with go language</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-15 02:38:57" itemprop="dateCreated datePublished" datetime="2022-05-15T02:38:57+00:00">2022-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-27 16:07:56" itemprop="dateModified" datetime="2022-05-27T16:07:56+00:00">2022-05-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="003-Declare-Quorum-queue-with-go-language"><a href="#003-Declare-Quorum-queue-with-go-language" class="headerlink" title="003.  Declare Quorum queue with go language"></a>003.  Declare Quorum queue with go language</h1><hr>
<p><a href="https://jam-boxes.com/build-a-rabbitmq-cluster-including-haporxy-by-docker-composer/">Last article</a> we describe how to build a RabbitMQ cluster, and this article we will show that declare quorum queue with go and do some simple test to quorum queue.</p>
<h2 id="What-we-need"><a href="#What-we-need" class="headerlink" title="What we need?"></a>What we need?</h2><hr>
<ul>
<li>library for RabbitMQ: <code>github.com/streadway/amqp</code></li>
<li>GoLang</li>
<li>A RabbitMQ Cluster - You can use way last article described or use other way official website do.</li>
</ul>
<h2 id="Initialize-and-connect-to-RabbitMQ"><a href="#Initialize-and-connect-to-RabbitMQ" class="headerlink" title="Initialize and connect to RabbitMQ"></a>Initialize and connect to RabbitMQ</h2><hr>
<p>First, we write a <code>rabbitMQService</code> package to handle detail of RabbitMQ.</p>
<ul>
<li><p>RabbitMQService struct:</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RabbitMQService <span class="keyword">struct</span> &#123;</span><br><span class="line">	account    <span class="type">string</span></span><br><span class="line">	password   <span class="type">string</span></span><br><span class="line">	host       <span class="type">string</span></span><br><span class="line">	vhost      <span class="type">string</span></span><br><span class="line">	connection *amqp.Connection</span><br><span class="line">	channel    *amqp.Channel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Constructor:</p>
<p>  Simply hard-code config, but this is only for  demo conveniently.</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRabbitMQService</span><span class="params">()</span></span> *RabbitMQService &#123;</span><br><span class="line">	<span class="comment">// should be replaced by env config load</span></span><br><span class="line">	account := <span class="string">&quot;guest&quot;</span></span><br><span class="line">	password := <span class="string">&quot;guest&quot;</span></span><br><span class="line">	host := <span class="string">&quot;localhost:5672&quot;</span></span><br><span class="line">	vhost := <span class="string">&quot;/&quot;</span></span><br><span class="line">	rabbitMQService := &amp;RabbitMQService&#123;account: account, password: password, host: host, vhost: vhost&#125;</span><br><span class="line">	rabbitMQService.getConnection()</span><br><span class="line">	rabbitMQService.getChannel()</span><br><span class="line">	rabbitMQService.SetQos(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">return</span> rabbitMQService</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Connect and open channel</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> getConnection() *amqp.Connection &#123;</span><br><span class="line">	connection, err := amqp.Dial(fmt.Sprintf(<span class="string">&quot;amqp://%s:%s@%s%s&quot;</span>, r.account, r.password, r.host, r.vhost))</span><br><span class="line">	failOnError(err, <span class="string">&quot;Failed to connect to RabbitMQ&quot;</span>)</span><br><span class="line">	r.connection = connection</span><br><span class="line">	<span class="keyword">return</span> r.connection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> getChannel() *amqp.Channel &#123;</span><br><span class="line">	<span class="keyword">if</span> r.connection == <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;Connection is nil.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	channel, err := r.connection.Channel()</span><br><span class="line">	failOnError(err, <span class="string">&quot;Failed to open a channel&quot;</span>)</span><br><span class="line">	r.channel = channel</span><br><span class="line">	<span class="keyword">return</span> r.channel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Close connection and  channel</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> Close() &#123;</span><br><span class="line">	<span class="keyword">if</span> r.channel != <span class="literal">nil</span> &#123;</span><br><span class="line">		err := r.channel.Close()</span><br><span class="line">		failOnError(err, <span class="string">&quot;Failed to close channel.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> r.connection != <span class="literal">nil</span> &#123;</span><br><span class="line">		err2 := r.connection.Close()</span><br><span class="line">		failOnError(err2, <span class="string">&quot;Failed to close connection.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Declare-Exchange"><a href="#Declare-Exchange" class="headerlink" title="Declare Exchange"></a>Declare Exchange</h2><hr>
<p>Define a <code>ExchangeType</code> type and constant help we to choose exchange type</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ExchangeType <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Direct  ExchangeType = <span class="string">&quot;direct&quot;</span></span><br><span class="line">	Topic   ExchangeType = <span class="string">&quot;topic&quot;</span></span><br><span class="line">	Headers ExchangeType = <span class="string">&quot;headers&quot;</span></span><br><span class="line">	Fanout  ExchangeType = <span class="string">&quot;fanout&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> ExchangeDeclare(name <span class="type">string</span>, exchangeType ExchangeType) &#123;</span><br><span class="line">	err := r.channel.ExchangeDeclare(</span><br><span class="line">		name, <span class="comment">// name</span></span><br><span class="line">		<span class="type">string</span>(exchangeType), <span class="comment">// type</span></span><br><span class="line">		<span class="literal">true</span>, <span class="comment">// durable</span></span><br><span class="line">		<span class="literal">false</span>, <span class="comment">// autoDelete</span></span><br><span class="line">		<span class="literal">false</span>, <span class="comment">// internal</span></span><br><span class="line">		<span class="literal">false</span>, <span class="comment">// noWait</span></span><br><span class="line">		<span class="literal">nil</span>, <span class="comment">// args</span></span><br><span class="line">	)</span><br><span class="line">	failOnError(err, <span class="string">&quot;Failed to declare an exchange&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Declare-Quorum-Queue"><a href="#Declare-Quorum-Queue" class="headerlink" title="Declare Quorum Queue"></a>Declare Quorum Queue</h2><hr>
<p>In order to specify queue’s type, we need to use <code>amqp.Table</code> and set “<code>x-queue-type&quot; = &quot;quorum&quot;</code> and <code>&quot;x-quorum-initial-group-size&quot; = &quot;5&quot;</code> .</p>
<ul>
<li><code>x-queue-type</code> :  set queue’s type. the default value is classic.</li>
<li><code>x-quorum-initial-group-size</code>:  set this argument to control the number of quorum queue members.</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> QuorumQueueDeclare(name <span class="type">string</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> r.isReady() &#123;</span><br><span class="line">		table := amqp.Table&#123;&#125;</span><br><span class="line">		table[<span class="string">&quot;x-queue-type&quot;</span>] = <span class="string">&quot;quorum&quot;</span></span><br><span class="line">		table[<span class="string">&quot;x-quorum-initial-group-size&quot;</span>] = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">		_, err := r.channel.QueueDeclare(</span><br><span class="line">			name,  <span class="comment">// name</span></span><br><span class="line">			<span class="literal">true</span>,  <span class="comment">// quorum queue most be durable</span></span><br><span class="line">			<span class="literal">false</span>, <span class="comment">// delete when unused</span></span><br><span class="line">			<span class="literal">false</span>, <span class="comment">// exclusive</span></span><br><span class="line">			<span class="literal">false</span>, <span class="comment">// no-wait</span></span><br><span class="line">			table, <span class="comment">// arguments</span></span><br><span class="line">		)</span><br><span class="line">		failOnError(err, <span class="string">&quot;Failed to declare a queue&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Queue-bind-to-Exchange"><a href="#Queue-bind-to-Exchange" class="headerlink" title="Queue bind to Exchange"></a>Queue bind to Exchange</h2><hr>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> QueueBind(queueName, routingKey, exchangeName <span class="type">string</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> r.isReady() &#123;</span><br><span class="line">		err := r.channel.QueueBind(</span><br><span class="line">			queueName,</span><br><span class="line">			routingKey,</span><br><span class="line">			exchangeName,</span><br><span class="line">			<span class="literal">false</span>,</span><br><span class="line">			<span class="literal">nil</span>,</span><br><span class="line">		)</span><br><span class="line">		failOnError(err, <span class="string">&quot;Failed to QueueBind&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Publish-and-Consume"><a href="#Publish-and-Consume" class="headerlink" title="Publish and Consume"></a>Publish and Consume</h2><hr>
<ul>
<li><p>Publish</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> Publish(exchangeName, routineKey, body <span class="type">string</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> r.isReady() &#123;</span><br><span class="line">		err := r.channel.Publish(</span><br><span class="line">			exchangeName, <span class="comment">// exchange</span></span><br><span class="line">			routineKey,   <span class="comment">// routing key</span></span><br><span class="line">			<span class="literal">false</span>,        <span class="comment">// mandatory</span></span><br><span class="line">			<span class="literal">false</span>,        <span class="comment">// immediate</span></span><br><span class="line">			amqp.Publishing&#123;</span><br><span class="line">				DeliveryMode: amqp.Persistent,</span><br><span class="line">				ContentType:  <span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">				Body:         []<span class="type">byte</span>(body),</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">		failOnError(err, <span class="string">&quot;Failed to publish a message&quot;</span>)</span><br><span class="line">		log.Printf(<span class="string">&quot; [x] Sent %s&quot;</span>, body)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Consume</p>
  <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RabbitMQService)</span></span> Consume(queueName, consumerName <span class="type">string</span>) &lt;-<span class="keyword">chan</span> amqp.Delivery &#123;</span><br><span class="line">	messages, err := r.channel.Consume(</span><br><span class="line">		queueName,    <span class="comment">// name</span></span><br><span class="line">		consumerName, <span class="comment">// consumer tags</span></span><br><span class="line">		<span class="literal">false</span>,        <span class="comment">// auto-ack</span></span><br><span class="line">		<span class="literal">false</span>,        <span class="comment">// exclusive</span></span><br><span class="line">		<span class="literal">false</span>,        <span class="comment">// no-local</span></span><br><span class="line">		<span class="literal">false</span>,        <span class="comment">// no-wait</span></span><br><span class="line">		<span class="literal">nil</span>,          <span class="comment">// args</span></span><br><span class="line">	)</span><br><span class="line">	failOnError(err, <span class="string">&quot;Failed to register a consumer&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> messages</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Server-Side-Code"><a href="#Server-Side-Code" class="headerlink" title="Server Side Code"></a>Server Side Code</h2><hr>
<ul>
<li>responsible for  declare queue, exchange and bind it.</li>
<li>consume queue</li>
<li>receive message and log message.</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;./helper&quot;</span></span><br><span class="line">	<span class="string">&quot;./rabbitMQService&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	mqService := rabbitMQService.NewRabbitMQService()</span><br><span class="line">	queueName := <span class="string">&quot;quorum-queue&quot;</span></span><br><span class="line">	mqService.QuorumQueueDeclare(queueName)</span><br><span class="line">	mqService.ExchangeDeclare(<span class="string">&quot;quorum.exchange&quot;</span>, rabbitMQService.Fanout)</span><br><span class="line">	mqService.QueueBind(queueName, <span class="string">&quot;quorum.queue&quot;</span>, <span class="string">&quot;quorum.exchange&quot;</span>)</span><br><span class="line">	deliverChan := mqService.Consume(queueName, <span class="string">&quot;client&quot;</span>)</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		mqService.Close()</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	forever := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> d := <span class="keyword">range</span> deliverChan &#123;</span><br><span class="line">			message := <span class="type">string</span>(d.Body)</span><br><span class="line">			log.Printf(<span class="string">&quot;%s%s&quot;</span>, <span class="string">&quot;Consume message: &quot;</span>, message)</span><br><span class="line">			err := d.Ack(<span class="literal">false</span>)</span><br><span class="line">			helper.FailOnError(err, <span class="string">&quot;Failed to ack a message&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot; [*] Awaiting Message&quot;</span>)</span><br><span class="line">	&lt;-forever</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Usage:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run .\server.<span class="keyword">go</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">22</span>:<span class="number">37</span>:<span class="number">35</span>  [*] Awaiting Message</span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span> Consume message: <span class="number">0</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span> Consume message: <span class="number">1</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span> Consume message: <span class="number">2</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span> Consume message: <span class="number">3</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span> Consume message: <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="Client-Side-Code"><a href="#Client-Side-Code" class="headerlink" title="Client Side Code"></a>Client Side Code</h2><hr>
<ul>
<li>Publish message</li>
<li>Take in an argument to decide  how many messages were published</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;./helper&quot;</span></span><br><span class="line">	<span class="string">&quot;./rabbitMQService&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	n := getArgs(os.Args)</span><br><span class="line">	mqService := rabbitMQService.NewRabbitMQService()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		mqService.Publish(<span class="string">&quot;quorum.exchange&quot;</span>, <span class="string">&quot;quorum.queue&quot;</span>, strconv.Itoa(i))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getArgs</span><span class="params">(args []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s <span class="type">string</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">len</span>(args) &lt; <span class="number">2</span>) || os.Args[<span class="number">1</span>] == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		helper.FailOnError(<span class="literal">nil</span>, <span class="string">&quot;wrong or absent Args&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		s = args[<span class="number">1</span>]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	n, err := strconv.Atoi(s)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		helper.FailOnError(err, <span class="string">&quot;Args not integer&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Usage:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">go</span> run .\client.<span class="keyword">go</span> <span class="number">5</span> </span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span>  [x] Sent <span class="number">0</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span>  [x] Sent <span class="number">1</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span>  [x] Sent <span class="number">2</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span>  [x] Sent <span class="number">3</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">14</span>:<span class="number">52</span>  [x] Sent <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="Inspect-Quorum-Queue-On-RabbitMQ-GUI"><a href="#Inspect-Quorum-Queue-On-RabbitMQ-GUI" class="headerlink" title="Inspect Quorum Queue On RabbitMQ GUI"></a>Inspect Quorum Queue On RabbitMQ GUI</h2><hr>
<p>After declaring quorum queue on server side, we can see quorum queue displayed on GUI like this:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:15672/">http://localhost:15672/</a></li>
</ul>
<p><img src="/../images/003.Declare-Quorum-queue-with-go-language/Untitled.png" alt="Untitled"></p>
<ul>
<li>The <code>+4</code> mean that there are <code>1 + 4</code>  node exists quorum-queue</li>
<li>The extra information tell that the quorum queue at <code>rabbitmq-cluster-02</code>, <code>rabbitmq-cluster-03</code>, <code>rabbitmq-cluster-04</code> , <code>rabbitmq-cluster-05</code> are follower.</li>
</ul>
<p>Now, we first stop server side program temporarily, and use client program to  send some message for testing.</p>
<p>we send 10 message first:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> run .\client.<span class="keyword">go</span> <span class="number">10</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">0</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">1</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">2</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">3</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">4</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">5</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">6</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">7</span></span><br><span class="line"><span class="number">2022</span>/<span class="number">05</span>/<span class="number">27</span> <span class="number">23</span>:<span class="number">30</span>:<span class="number">23</span>  [x] Sent <span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>There are 10 message on queue:</p>
<p><img src="/../images/003.Declare-Quorum-queue-with-go-language/Untitled%201.png" alt="Untitled"></p>
<p>Then we stop the first node of RabbitMQ cluster for testing.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose stop rabbitmq-cluster<span class="number">-01</span></span><br><span class="line">[+] Running <span class="number">1</span>/<span class="number">1</span></span><br><span class="line"> - Container rabbitmq-cluster<span class="number">-01</span>  Stopped</span><br></pre></td></tr></table></figure>

<p>Now first node is down.</p>
<p><img src="/../images/003.Declare-Quorum-queue-with-go-language/Untitled%202.png" alt="Untitled"></p>
<p>Then we go to check quorum queue:</p>
<p><img src="/../images/003.Declare-Quorum-queue-with-go-language/Untitled%203.png" alt="Untitled"></p>
<p>You can see these message still there and the master node change from <code>rabbitmq-cluster-01</code> to <code>rabbitmq-cluster-05</code> .</p>
<p>Therefore, when we use quorum queue, we can make sure that The Message Broker  has high availability. </p>
<p>The Consumer and The Publisher still can work even one of  RabbitMQ node down.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><hr>
<ul>
<li><p>The most usage of quorum queue is same as classic queue beside we need to declare queue by setting <code>x-queue-type=quorum</code> .</p>
</li>
<li><p>The quorum queue with RabbitMQ cluster can provide high availability to your Message Broker System.</p>
</li>
<li><p>Another queue was used  to be used on RabbitMQ cluster is  Mirrored Queues.</p>
<p>  Since the official website say  “**Quorum queues should be considered the default option for a replicated queue type.**”,  </p>
<p>  we don’t use it unless you have own reasons.</p>
</li>
</ul>
<h2 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h2><hr>
<ul>
<li>RabbitMQ sample code: <a target="_blank" rel="noopener" href="https://github.com/chun-hunag/rabbitmq-sample/tree/main/golang/QuorumQueue">https://github.com/chun-hunag/rabbitmq-sample/tree/main/golang/QuorumQueue</a></li>
<li>environment: <a target="_blank" rel="noopener" href="https://github.com/chun-hunag/rabbitmq-sample/tree/main/rabbitmq-cluster-env">https://github.com/chun-hunag/rabbitmq-sample/tree/main/rabbitmq-cluster-env</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jam-boxes.com/how-to-build-blog-by-hexo-with-theme-%E2%80%9Cnext/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/Tombili_mini.jpg">
      <meta itemprop="name" content="jam huang">
      <meta itemprop="description" content="Share tech notes and investment experience">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jam's Box">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/how-to-build-blog-by-hexo-with-theme-%E2%80%9Cnext/" class="post-title-link" itemprop="url">How to build blog by hexo with theme “next"</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-02 22:12:57" itemprop="dateCreated datePublished" datetime="2022-05-02T22:12:57+00:00">2022-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-04 13:22:55" itemprop="dateModified" datetime="2022-05-04T13:22:55+00:00">2022-05-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="How-to-build-blog-by-hexo-with-theme-“next”"><a href="#How-to-build-blog-by-hexo-with-theme-“next”" class="headerlink" title="How to build blog by hexo with theme “next”."></a>How to build blog by hexo with theme “next”.</h1><hr>
<p>This article will show how to build a blog by hexo and host on Github page.</p>
<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><hr>
<ul>
<li>A GitHub account</li>
<li>Node.js runtime environment</li>
<li>Git</li>
</ul>
<h2 id="Create-a-Repository-with-user-name-github-io"><a href="#Create-a-Repository-with-user-name-github-io" class="headerlink" title="Create a Repository with {user_name}.github.io"></a>Create a Repository with <code>&#123;user_name&#125;.github.io</code></h2><hr>
<ol>
<li><p>Create Repository</p>
<p> <code>&#123;user_name&#125;</code> must be the same as your github’s username.</p>
<p> <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled.png" alt="Untitled"></p>
</li>
<li><p>Clone your repository to local.</p>
<p> <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%201.png" alt="Untitled"></p>
</li>
<li><p>Execute command locally:</p>
<p> <code>$ git clone &#123;what you just copy&#125;</code></p>
<p> Example:  <code>$ git clone  https://github.com/&#123;user-name&#125;/&#123;user-name&#125;.github.io.git</code></p>
</li>
</ol>
<h2 id="Install-hexo-by-npm-amp-Initialize-the-project"><a href="#Install-hexo-by-npm-amp-Initialize-the-project" class="headerlink" title="Install hexo by npm &amp; Initialize the project"></a>Install hexo by npm &amp; Initialize the project</h2><hr>
<ul>
<li><p><code>$ npm install -g hexo-cli</code></p>
</li>
<li><p><code>$ cd &#123;your repository local directory&#125;</code></p>
</li>
<li><p><code>$ mkdir src</code></p>
</li>
<li><p><code>$ cd src</code></p>
</li>
<li><p><code>hexo init</code></p>
<p>  You should see:</p>
  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">INFO</span>  <span class="title class_">Cloning</span> hexo-starter <span class="attr">https</span>:<span class="comment">//github.com/hexojs/hexo-starter.git</span></span><br><span class="line"><span class="variable constant_">INFO</span>  <span class="title class_">Install</span> dependencies</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve@<span class="number">0.5</span><span class="number">.3</span>: <span class="title class_">See</span> <span class="attr">https</span>:<span class="comment">//github.com/lydell/source-map-resolve#deprecated</span></span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; urix@<span class="number">0.1</span><span class="number">.0</span>: <span class="title class_">Please</span> see <span class="attr">https</span>:<span class="comment">//github.com/lydell/urix#deprecated</span></span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve &gt; urix@<span class="number">0.1</span><span class="number">.0</span>: <span class="title class_">Please</span> see <span class="attr">https</span>:<span class="comment">//github.com/lydell/urix#deprecated</span></span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve &gt; resolve-url@<span class="number">0.2</span><span class="number">.1</span>: <span class="attr">https</span>:<span class="comment">//github.com/lydell/resolve-url#deprecated</span></span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve &gt; source-map-url@<span class="number">0.4</span><span class="number">.1</span>: <span class="title class_">See</span> <span class="attr">https</span>:<span class="comment">//github.com/lydell/source-map-url#deprecated</span></span><br><span class="line"><span class="variable constant_">INFO</span>  <span class="title class_">Start</span> blogging <span class="keyword">with</span> <span class="title class_">Hexo</span>!</span><br></pre></td></tr></table></figure>
</li>
<li><p>Directory structure like below:</p>
<p>  <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%202.png" alt="Untitled"></p>
</li>
</ul>
<h2 id="Config-deployment-setting"><a href="#Config-deployment-setting" class="headerlink" title="Config deployment setting"></a>Config deployment setting</h2><hr>
<ul>
<li><p>Modify  <code>src/_config.yml</code></p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//hexo.io/docs/one-command-deployment</span></span><br><span class="line">deploy<span class="punctuation">:</span></span><br><span class="line">  type<span class="punctuation">:</span> git</span><br><span class="line">  repo<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//github.com/&#123;user_name&#125;/&#123;user_name&#125;.github.io</span></span><br><span class="line">  branch<span class="punctuation">:</span> gh-pages</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Download-themes"><a href="#Download-themes" class="headerlink" title="Download themes"></a>Download themes</h2><hr>
<ul>
<li><p>URL: <a target="_blank" rel="noopener" href="https://github.com/theme-next/hexo-theme-next">https://github.com/theme-next/hexo-theme-next</a></p>
</li>
<li><p><code>$ cd src/themes</code></p>
</li>
<li><p><code>$ git clone https://github.com/theme-next/hexo-theme-next.git</code></p>
</li>
<li><p>rename folder to next:</p>
<p>  <code>$ mv hexo-theme-next/ next</code></p>
</li>
</ul>
<h2 id="Config-themes"><a href="#Config-themes" class="headerlink" title="Config themes"></a>Config themes</h2><hr>
<ul>
<li><p>Modify  <code>src/_config.yml</code></p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Exensions</span><br><span class="line">## Plugins<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//hexo.io/plugins/</span></span><br><span class="line">## Themes<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//hexo.io/themes/</span></span><br><span class="line">theme<span class="punctuation">:</span> next</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><hr>
<ul>
<li><p><code>$ cd src/</code></p>
</li>
<li><p><code>$ hexo generate</code></p>
</li>
<li><p><code>$ hexo deploy</code></p>
</li>
<li><p>Go to your repository page on Github and you should see one more branch show up</p>
<p>  <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%203.png" alt="Untitled"></p>
</li>
<li><p>config page setting</p>
<ol>
<li><p>Click Setting</p>
<p> <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%204.png" alt="Untitled"></p>
</li>
<li><p>Click Pages</p>
<p> <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%205.png" alt="Untitled"></p>
</li>
<li><p>Set Soruce branch to gh-pages</p>
<p> <img src="/../images/001.How-to-build-blog-by-hexo-with-theme-next/Untitled%206.png" alt="Untitled"></p>
</li>
</ol>
</li>
<li><p>Check your page on url: <code>&lt;username&gt;.github.io</code></p>
</li>
</ul>
<h2 id="Config-Basic-Information-of-Blog"><a href="#Config-Basic-Information-of-Blog" class="headerlink" title="Config Basic Information of Blog"></a>Config Basic Information of Blog</h2><hr>
<ul>
<li>Modify  <code>src/_config.yml</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Jam&#x27;s</span> <span class="string">Box</span> <span class="comment"># website title</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;Leaning Note&#x27;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&#x27;Share tech notes and investment experience&#x27;</span>  <span class="comment"># website description</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="comment"># The keywords of your website. Supports multiple values.</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">jam</span> <span class="string">huang</span>  <span class="comment"># author name</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">en</span> <span class="comment"># language family</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&#x27;&#x27;</span> <span class="comment"># time zone, the default value is the same as your OS time zone</span></span><br></pre></td></tr></table></figure>

<h2 id="Config-Basic-Information"><a href="#Config-Basic-Information" class="headerlink" title="Config Basic Information"></a>Config Basic Information</h2><hr>
<ul>
<li>Modify  <code>src/_config.yml</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://jam-boxes.com</span> <span class="comment"># The URL of your website</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:post_title/</span> <span class="comment"># your article&#x27;s url format</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jam huang"
      src="/images/Tombili_mini.jpg">
  <p class="site-author-name" itemprop="name">jam huang</p>
  <div class="site-description" itemprop="description">Share tech notes and investment experience</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chun-hunag" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chun-hunag" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hgfrttlk@gmail.com" title="E-Mail → mailto:hgfrttlk@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/%E4%BF%8A%E7%91%9D-%E9%BB%83-554b02120" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;%E4%BF%8A%E7%91%9D-%E9%BB%83-554b02120" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fab fa-connectdevelop"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jam huang</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  

    </div>
</body>
</html>
